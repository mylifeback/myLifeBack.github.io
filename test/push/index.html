<html>
    <head>
        <title>push</title>
        <link rel="icon" type="image/x-icon" href="./src/favicon.ico" />
        <!-- <script src="webcomponents.js" defer></script> -->

    </head>
    <body>

        <button id="p"> click me</button>



        <script defer>
            const c = document.getElementById('p');
            const b = document.getElementById('p');
            debugger
            console.log(b);
            console.log(c);
            c.addEventListener ('click', ()=>{
                Notification.requestPermission().then((result)=>{
                    if (result ==="granted") {
                        randomNotification();
                    }
                })
            });

            function randomNotification (){
                new Notification ("i got new message", {body: "this is my body"});

            }

            navigator.serviceWorker.register('serviceworker.js')
            .then((registration) => {
                console.log(registration);
                return registration.pushManager
                    .getSubscription()
                    .then (async (subscription) => {
                        console.log (subscription)
                    })
            })
            .then ((subscription) => {
                console.log (subscription);
            })

            // const response = await fetch ('https://crawford1903.mynetgear.com:5678/getkey');
            // const vapidPublicKey = await response.text();
            // const VAPIDkey = urlBase64ToUint8Array (vapidPublicKey);

            const converted = 'BOYdZKgUKer8SPDRmV9-D6U9uQwtPGbRVan_u9p_ORhK5W1p6tIgwzq1lecia6dInT6bws3EaG_OepoeozKd1ac';

            console.log (converted);

            const sub = registration.pushManager.subscribe ({
                userVisibleOnly: true,
                applicationServerKey: converted
            });

            console.log ("subscribed >>> " + sub);

            // fetch ('https://crawford1903.mynetgear.com:5678/register', {
            //     method: 'post',
            //     headers: {
            //         "content-type": "application/json",
            //     },
            //     body: JSON.stringify({subscription}),
            // });



         </script>
    </body>
</html>
