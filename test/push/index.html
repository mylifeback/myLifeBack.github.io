<html>
    <head>
        <title>push</title>
        <link rel="icon" type="image/x-icon" href="./src/favicon.ico" />

    </head>
    <body>
        <button id="p"> click me</button>
        <script>
            const c = document.getElementById('p');
            console.log(c);
            c.addEventListener ('click', ()=>{
                Notification.requestPermission().then((result)=>{
                    if (result ==="granted") {
                        randomNotification('first message');
                    }
                })
            });

            function randomNotification (e){
                new Notification ("MESSAGE HEAD", {body: e});
            }

            function pushMessage (m){
                     fetch ('https://127.0.0.1:1880/push', {
                                method: 'post',
                                headers: {
                                    "content-type": "application/json",
                                    "Access-Control-Request-Private-Network": "true",
                                },
                                body: m,
                            })
                            .then ((response) => {
                                console.log (response);
                            });
            }

            const ele = document.getElementById('p');
            p.addEventListener ('click', pushMessage ('hello world'));

            debugger

            navigator.serviceWorker.register('serviceworker.js')
            .then((registration) => {
                console.log(registration);  
                // const converted = 'BO8lIOGxBf7-QfeeyCJ643y7r8h4pM9ygw2XT2koUuvKe9vH8-GalfyFg4xyP16V4C65X6kUJCokEQPrJeumKTg';
                const converted = 'BPhRH4ASnKOZXdUAzOW0A2Pau1NYAJs6aiKM8Vp8HyM3WpbH6ZHKZL06xuT565hWiiOe1deNBDpY3-P7aPi8_v4';
                console.log (converted);
                // registration.pushManager.unsubscribe ();
                registration.pushManager.subscribe ({
                    userVisibleOnly: true,
                    applicationServerKey: converted
                })
                // .then ((subscription) => {
                //     console.log ("subscribed >>> " + subscription);
                // });
                            
                registration.pushManager
                    .getSubscription()
                        .then ((subscription) => {
                            console.log (subscription);
                            console.log (subscription.endpoint);
                            console.log (subscription.expirationTime);
                            console.log (subscription.options);
                            const str = JSON.stringify({subscription});
                            console.log (str);

                            // fetch ('https://crawford1903.mynetgear.com:5678/register', {
                            fetch ('https://127.0.0.1:1880/register', {
                                method: 'post',
                                headers: {
                                    "content-type": "application/json",
                                    "Access-Control-Request-Private-Network": "true",
                                },
                                body: str,
                            })
                            .then ((response) => {
                                console.log (response);
                            });
                    });
            });

            // fetch ('https://crawford1903.mynetgear.com:5678/register', {
            //     method: 'post',
            //     headers: {
            //         "content-type": "application/json",
            //     },
            //     body: JSON.stringify({subscription}),
            // });
         </script>
    </body>
</html>
