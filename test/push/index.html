<html>
    <head>
        <title>push</title>
        <link rel="icon" type="image/x-icon" href="./src/favicon.ico" />
        <!-- <script src="webcomponents.js" defer></script> -->

    </head>
    <body>

        <button id="p"> click me</button>



        <script>
            const c = document.getElementById('p');
            console.log(c);
            c.addEventListener ('click', ()=>{
                Notification.requestPermission().then((result)=>{
                    if (result ==="granted") {
                        randomNotification('first message');
                    }
                })
            });

            function randomNotification (e){
                new Notification ("MESSAGE HEAD", {body: e});
            }

            debugger
            navigator.serviceWorker.register('serviceworker.js')
            .then((registration) => {
                console.log(registration);  
                const converted = 'BOYdZKgUKer8SPDRmV9-D6U9uQwtPGbRVan_u9p_ORhK5W1p6tIgwzq1lecia6dInT6bws3EaG_OepoeozKd1ac';
                console.log (converted);
                registration.pushManager.subscribe ({
                    userVisibleOnly: true,
                    applicationServerKey: converted
                })
                .then (subscription){
                    console.log ("subscribed >>> " + subscription);
                };
                            
                registration.pushManager
                    .getSubscription()
                        .then ((subscription) => {
                            console.log (subscription);
                            console.log (subscription.endpoint);
                            console.log (subscription.expirationTime);
                            console.log (subscription.options);
                            // return subscription;
                        });
            });



            // const response = await fetch ('https://crawford1903.mynetgear.com:5678/getkey');
            // const vapidPublicKey = await response.text();
            // const VAPIDkey = urlBase64ToUint8Array (vapidPublicKey);



            // fetch ('https://crawford1903.mynetgear.com:5678/register', {
            //     method: 'post',
            //     headers: {
            //         "content-type": "application/json",
            //     },
            //     body: JSON.stringify({subscription}),
            // });



         </script>
    </body>
</html>
